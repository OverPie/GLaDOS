import vk_api, math, random, requests, base64, wikipedia, subprocess
from vk_api.utils import get_random_id
from loadevn import group_idd, apinews
from vk_bot.core.sql.vksql import *
from vk_bot.core.sql.sqlgame import hellosql
from vk_api import VkUpload
from datetime import timedelta
import pyPrivnote
wikipedia.set_lang("ru")
helpspisok = ["/help", "/—Ö–µ–ª–ø", "/–Ω–∞—á–∞—Ç—å", "/–ø–æ–º–æ—â—å", "/–∫–æ–º–∞–Ω–¥—ã", "/—Å—Ç–∞—Ä—Ç"]
help = """–î—Ä–æ—É. –ï—Ç–æ –±–æ—Ç –∫–æ–º–∞–Ω–¥—ã –æ–≤–æ—â–µ–π. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
üßæ–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª: /–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 2 + 2
‚òÅ/–ø–æ–≥–æ–¥–∞ - –º–æ–Ω–∞ –ø–∏—Å–∞—Ç—å –≥–æ—Ä–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç = –∏–Ω–≥–∏—à, –∏–≥–Ω–æ—Ä = –æ—à–∏–±–∫–∞
‚ù§–ø—Ä–∏–≤–µ—Ç\—Å–ø–æ–∫–∏ - :–ó
üê± /–∫–∞—Ç—ã - —Å–∫–∏–Ω–µ—Ç –ø–∏–∫—á—É –∫–æ—Ç–∏–∫–∞ –∏–ª–∏ –Ω–µ–∫–æ
üá¨üáß - /–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫
üè≥‚Äçüåà/—è–æ–π, —é—Ä–∏, —Ç—Ä–∞–ø—ã, –≥–µ–±–±–µ–ª—å—Å, –º–∞—Ö–Ω–æ, –∫–∞–ª—è–Ω, –º–µ–º, –Ω–æ–≥–∏\–Ω–æ–∂–∫–∏, –∞–¥–æ–ª—å—Ñ\–≥–∏—Ç–ª–µ—Ä, —Ö–µ—Å - —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à—É –∂–∏–∑–Ω—å –ª—É—á—à–µ üåö
–∞ —Ç–∞–∫ –∂–µ, –∫–ª—é—á -c –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏–∫—á.
–ù–∞–ø—Ä–∏–º–µ—Ä: /—è–æ–π -c 7
üëçüèª/–æ—Ü–µ–Ω–∏ - –æ—Ü–µ–Ω–∫–∞ –ø–æ 10—Ç–∏ –±–∞–ª—å–Ω–æ–π —à–∫–∞–ª–µ
üìö /–≤–∏–∫–∏ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –≤–∏–∫–∏
üé¨/–≤–∏–¥–µ–æ –Ω–∞–∑–≤–∞–Ω–∏–µ - —Ä–∞–Ω–¥–æ–º–Ω–æ–µ –≤–∏–¥–µ–æ —Å –≤–∞—à–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
‚úî/–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å /—à–∞–Ω—Å—ã - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á–µ–≥–æ –ª–∏–±–æ
üåö/—Ö–µ–Ω—Ç–∞–π - üåöüåöüåö
‚ùì/–≤—ã–±–µ—Ä–∏ - /–≤—ã–±–µ—Ä–∏ –æ–≥—É—Ä—Ü—ã —Å –º–æ–ª–æ–∫–æ–º –∏–ª–∏ –≥—Ä–µ—á–∫–∞ —Å –∫–µ—Ç—á—É–ø–æ–º
üê¥/—Å–º–µ—Ö - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—Ö–∞, —Å -h –≤—ã–¥–∞—Å—Ç —Å–ø—Ä–∞–≤–∫—É
üëÖ/–ø–æ–≤—Ç–æ—Ä–∏ - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
üíæ/–≥–∏—Ñ –∏–ª–∏ /–¥–æ–∫ - —Å–∫–∏–Ω–µ—Ç –≤–∞–º –≥–∏—Ñ–∫—É –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
&#128064;/–∫—Ç–æ - –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –±–µ—Å–µ–¥–µ –ø–æ–¥ –≤–∞—à–∏–º –ø—Ä–µ–¥–ª–æ–≥–æ–º
&#128181;/–∫—É—Ä—Å - –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –∏ –µ–≤—Ä–æ
‚ö∞/–¥–∞—Ç–∞ - –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –≤–∞–º–∏ —Å–æ–±—ã—Ç–∏–µ
üé≤/—á–∏—Å–ª–æ - –≤—ã–±—Ä–∞—Ç—å —á–∏—Å–ª–æ –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞. –ü—Ä–∏–º–µ—Ä: /—á–∏—Å–ª–æ 1 500
&#128101;/–æ–Ω–ª–∞–π–Ω - –ø–æ–∫–∞–∂–µ—Ç –æ–Ω–ª–∞–π–Ω –±–µ—Å–µ–¥—ã
üë§/–ø—Ä–µ—Ñ–∏–∫—Å - –∫–∞–∫ –≤–∞—Å –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å –±–æ—Ç
üí±/–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä - –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç—ã, —Å usd –∏ eur (/–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä 5000 usd)
üîí/–∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å <–≤–∞—à —Ç–µ–∫—Å—Ç> /—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å <–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—É–ª –±–æ—Ç –ø–æ—Å–ª–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è>
üì∞/–Ω–æ–≤–æ—Å—Ç—å - –ø–æ–∫–∞–∂–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
&#128102;/–ø—Ä–æ—Ñ–∏–ª—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ
üìù/–±–∏–Ω–∞—Ä–Ω—ã–π0/1: 0 - –∑–∞—à–∏—Ñ—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –±–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–¥, –∞ 1 - —Ä–∞—Å—à–∏—Ñ—Ä—É–µ—Ç
üèù/–ø–µ—Ä–µ—à–ª–∏ - –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
üîç/–∞–Ω–∏–º–µ –Ω–∞ —Ñ–æ—Ç–æ - –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤–∞–º –∞–Ω–∏–º–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–Ω–æ–µ –Ω–∞ —Ñ–æ—Ç–æ
üëãüèª/–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–µ—Å–µ–¥—ã
üìö/–∞–ª—å–±–æ–º—ã - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞—à–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∞–ª—å–±–æ–º–∞. –í—ã–∑–æ–≤ –±–µ–∑ –≤—Å–µ–≥–æ —Å–∫–∏–Ω–µ—Ç —Å–ø—Ä–∞–≤–∫—É
üìã/–∞–π–¥–∏ - —Å–∫–∏–Ω—É—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–π –∞–π–¥–∏ –≥—Ä—É–ø–ø—ã\—á–µ–ª–æ–≤–µ–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: /–∞–π–¥–∏ slava_air
üîí/encodeqr - –∑–∞—à–∏—Ñ—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ qrcode , /decodeqr - —Ä–∞—Å—à–∏—Ñ—Ä—É–µ—Ç qrcode
üìÅ/–≥—Ä—É–ø–ø—ã - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞—à–∏—Ö –≥—Ä—É–ø–ø, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è —Ä–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Å—Ç
‚úçüèª/–¥–ª–∏–Ω–∞ - —Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –≤–∞—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–µ —Å—á–∏—Ç–∞—è —Å–∞–º—É –∫–æ–º–∞–Ω–¥—É
üîí/–ø–∞—Ä–æ–ª—å - –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–ª–∏–Ω—É /–ø–∞—Ä–æ–ª—å 69, –µ–∂–µ–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å - –±—É–∏—Ç 64
üí∞/—á–µ–∫–Ω–∏ –¥–æ–Ω–∞—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ–Ω–∞—Ç–∏–ª–∏ –ª–∏ –≤—ã –∏ —Å–∫–æ–ª—å–∫–æ
üì∫/–ø–æ—Å—Ç—ã - –ø–æ–∏—Å–∫–æ–≤ –ø–æ—Å—Ç–æ–≤, –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º —Ç–µ–≥–∞–º –∏–ª–∏ —Ç–µ–∫—Å—Ç—É
github.com/anar66/vk-bot
"""
def translit(text, vk=False, english=False):
    apikey = "trnsl.1.1.20190508T201810Z.385ebfa1e596baa0.90672cf8655555b1b51ced31b03c2e8bb9bde46c"
    url = "https://translate.yandex.net/api/v1.5/tr.json/translate"
    url2 = "https://translate.yandex.net/api/v1.5/tr.json/detect"
    params = {"key": apikey,
                "text":text[1:]}
    r = requests.get(url2, params=params)
    encode = r.json()
    lang = f"{encode['lang']}-ru"
    if english:
        lang = "ru-en"
    params = {"key": apikey,
            "text":text[0:],
            "lang":lang}
    r = requests.get(url, params=params)
    encode = r.json()
    try:
        if vk:
            encode = " ".join(encode["text"][1:])
            return {"message":"–ü–µ—Ä–µ–≤–æ–¥: {}".format(encode),}
    except:
        return
    return encode["text"][0]
def shellrun(text):
    text = " ".join(text[1:])
    try:
        result = subprocess.check_output(text, shell=True, encoding="utf-8")
    except:
        return {"message":"!error"}
    return {"message":result}

def weather(text):
    try:
        qr = text[1]
    except:
        return
    q = translit(text=qr, english=True); q.lower()
    apiurl = "http://api.openweathermap.org/data/2.5/find"
    appid = '22c7bf8e593c47b0cf88f390e8e5376a'
    params = {
                'q': q,
                'appid': appid,
                'units': 'metric',
                'lang': 'ru'
                }
    try:
        r = requests.get(apiurl, params=params, timeout=5)
        encode = r.json()
        w = encode['list'][0]['weather'][0]['description']
        temp = encode["list"][0]["main"]["temp"]
        vlaga = encode["list"][0]["main"]["humidity"]
        wind = encode["list"][0]["wind"]["speed"]
    except:
        return
    return {"message":f"""–ì–æ—Ä–æ–¥: {q}
    üå•–ü–æ–≥–æ–¥–∞: {w}
    üå°–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp}¬∞
    üíß–í–ª–∞–∂–Ω–æ—Å—Ç—å: {vlaga}
    üí®–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: {wind}–º/—Å""",
    }
def answer(text):
    zapros = text[0].lower()
    if zapros == "—Å–ø–æ–∫–∏" or zapros == "—Å–ø–æ–∫–æ–π–Ω–æ–π":
        answer = ["–°–ø–æ—Ç—å–∫–∏", "–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏", "–°–ø–∏, –Ω–æ —è –ø—Ä–∏–¥—É –∏ –≤—ã–µ–±—É —Ç–µ–±—è –∏—Å—Ç–æ—Ä–∏–µ–π –∞–∏—Ä"
                  ,"–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤", "–≠—Ä–æ—Ç–∏—à–Ω—ã—Ö —Å–Ω–æ–≤üåöüåöüåö"]
    else:
        answer = ["–ö—É–∫", "–∑–∏–≥ —Ö–∞–π–ª—å", "–∫—É–∫—É –Ω–∞—Ö—É–π",
                   "üá∫üá¶—Å–ª–∞–≤–∞ —É–∫—Ä–∞–∏–Ω–µüá∫üá¶", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", "–∑–¥—Ä–∞–≤–∏—è –∂–µ–ª–∞—é"]
    return {"message":random.choice(answer),}
def status(vk, msgcount):
    vk.status.set(text=f"‚úâ—Å–æ–æ–±—â–µ–Ω–∏–π: {msgcount}", group_id=group_idd)
def callall(vk, event):
    calllist = []
    callid = vk.messages.getConversationMembers(peer_id=event.object.peer_id)
    for a in callid:
        calllist.append(f"@id{str(a['id'])} ({a['first_name']} {a['last_name']})")
    calljoin = ", ".join(calllist)
    return {"message":f"–Ø –ü–†–ò–ó–´–í–ê–Æ –í–ê–°:\n{calljoin}"}
def getusername(vk, uid):
    try:
        requests = vk.users.get(user_ids=uid, fields="first_name")
    except vk_api.exceptions.ApiError:
        return
    response = requests[0]["first_name"]
    return response
def vkbase64(text, encode=False, decode=False):
    text = " ".join(text[1:])
    try:
        if encode:
            result = base64.b64encode(bytes(text, 'utf-8'))
        else:
            result = base64.b64decode(text)
    except:
        return {"message":"!error"}
    return {"message":result.decode('utf-8')}
def profile(uid, mc2):
    msg = checktable('messages', 'id', uid)["msg"]
    xp = checktable('level', 'id', uid)["xp"]
    levelxp = 500
    level = 0
    while xp > levelxp:
        levelxp = levelxp * 2.5
        level += 1
    if mc2["admins"]:
        user = "–ê–¥–º–∏–Ωüòé"
    elif mc2["vips"]:
        user = "–í–∏–øü§µ"
    else:
        user = "–Æ–∑–µ—Ä"
    G = checktable("economy","id", uid)["money"]
    return {"message": f"""–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:
üë¶| –†–æ–ª—å: {user}
üîë| –ü—Ä–µ—Ñ–∏–∫—Å: {mc2['prefix']}
üìÉ| –ê–π–¥–∏: id{uid}
‚úâ | –°–æ–æ–±—â–µ–Ω–∏—è: {msg}
üí∞| G: {G}$
üéÆ| XP: {xp}
‚≠ê| –£—Ä–æ–≤–µ–Ω—å: {level}"""}
def nametoid(vk, text):
    try:
        text = text[1]
        result = vk.utils.resolveScreenName(screen_name=text)
        if result["type"] == "group":
            result = "-" + str(result["object_id"])
        else:
            result = result["object_id"]
    except KeyboardInterrupt:
        return {"message":"!error"}
    return {"message":f"–ê–π–¥–∏: {result}"}
def tasks():
    ltasks = """üö´–º–∞—Ç—å –ø–∞–Ω–µ–ª—å
    ‚úÖ—Ä–∞—Å—Å—ã–ª–∫–∞
    ‚úÖ–æ–æ–ø
    ‚úÖ–º–Ω–æ–≥–æ–ø–æ—Ç–æ–∫
    ‚úÖ—Ä–∞–±–æ—Ç–∞ —Å –ø–∏–∫—á–∞–º–∏
    üö´—ç–∫–æ–Ω–æ–º–∏–∫–∞\—Ä–ø–≥
    ‚úÖ–∫–µ—à
    ‚úÖ–Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—á–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤ –¥–ª—è –≤–∏–ø–æ–≤
    ‚úÖ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –¥–µ—Ç–æ–≤–æ–¥—Å—Ç–≤–æ–º
    ‚úÖ–∞–≤—Ç–æ–∫–æ–Ω–≤–µ–Ω—Ç–æ—Ä –∞–π–¥–∏ –≤ —Ç–µ—Ö –∂–µ –∞–ª—å–±–æ–º–∞—Ö
    ‚úÖ—Å–ø–∏—Å–æ–∫ –∏–¥–µ–π
    ‚úÖ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    ‚úÖ–ª–∏—á–Ω—ã–µ –∞–ª—å–±–æ–º—ã
    ‚úÖ–∞–Ω–∏–º–µ –Ω–∞ —Ñ–æ—Ç–æ"""
    return {"message":ltasks}
def gethistorytols(vk, event):
    history = vk.messages.getHistory(count=0, user_id=event.user_id)["count"]
    return {"message":f"—Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ª—Å: {history}"}
def nuke():
    return {"message":"–í–°–ï –ü–ò–ó–î–ê –ò–í–ê–ù–£. /–∑–∞–ø—É—Å—Ç–∏–ª —è–¥–µ—Ä–Ω—É—é –±–æ–µ–≥–æ–ª–æ–≤–∫—É –≤ –º–∞–∫—Å–±–æ—Ç–∞/", "attachment":"video162900694_456239801"}
